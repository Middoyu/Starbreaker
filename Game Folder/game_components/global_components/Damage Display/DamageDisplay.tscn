[gd_scene load_steps=3 format=3 uid="uid://bfrqijlkiagie"]

[sub_resource type="LabelSettings" id="LabelSettings_a5ygm"]
font_size = 10

[sub_resource type="GDScript" id="GDScript_f0jcg"]
resource_name = "damage_display"
script/source = "extends Label
var spawning_tween_duration = 0.15
var movement_tween_duration = 0.60

func _ready() -> void:
	int_setup()


func int_setup():
	reposition_display()
	remove_other_displays()
	wait(spawning_tween_duration, slowly_move_display)
	wait(spawning_tween_duration + movement_tween_duration, remove_display)

func wait(time, function):
	var timer = get_tree().create_timer(time)
	timer.connect(\"timeout\", function)

func reposition_display():
	pivot_offset = Vector2(size.x / 2, size.y / 2)
	position.x -= size.x / 2
	var spawning_tween_movement = create_tween().set_parallel(true)
	spawning_tween_movement.tween_property(self, \"position:y\", global_position.y + -45, spawning_tween_duration)

func remove_other_displays():
	for i in global.current_stage.get_children():
		if i.is_in_group(\"DamageDisplay\"):
			i.remove_display()
	add_to_group(\"DamageDisplay\")
	reparent(global.current_stage)

func slowly_move_display():
	var tween_movement = create_tween().set_parallel(true)
	tween_movement.tween_property(self, \"position:y\", global_position.y + randf_range(-10, -5), movement_tween_duration)
	tween_movement.tween_property(self, \"position:x\", global_position.x + randf_range(-5, 5), movement_tween_duration)

func remove_display():
	var remove_display_tween = create_tween().set_parallel(true)
	remove_display_tween.tween_property(self, \"scale:x\", 0, 0.5).set_ease(Tween.EASE_IN_OUT).set_trans(Tween.TRANS_BACK)
	remove_display_tween.tween_property(self, \"scale:y\", 0, 0.5).set_ease(Tween.EASE_IN_OUT).set_trans(Tween.TRANS_BACK)
	wait(0.7, queue_free)
"

[node name="DamageDisplay" type="Label"]
offset_right = 19.0
offset_bottom = 23.0
mouse_filter = 1
text = "33"
label_settings = SubResource("LabelSettings_a5ygm")
horizontal_alignment = 1
vertical_alignment = 1
script = SubResource("GDScript_f0jcg")
